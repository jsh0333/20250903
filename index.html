<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>유품정리 사전 체크리스트 </title>
<style>
  :root{ --bg:#f7f8fb; --card:#ffffff; --ink:#1f2937; --muted:#6b7280; --accent:#0ea5e9; --line:#e5e7eb; }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,-apple-system,'Noto Sans KR',Apple SD Gothic Neo,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--ink)}
  header{background:#fff; border-bottom:1px solid var(--line); position:sticky; top:0; z-index:10;}
  .wrap{max-width:1100px; margin:0 auto; padding:16px;}
  h1{font-size:20px; margin:10px 0}
  .grid{display:grid; grid-template-columns:1fr; gap:12px}
  @media(min-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
  .card{background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px;}
  .card h2{font-size:16px; margin:0 0 10px}
  .row{display:grid; grid-template-columns:160px 1fr; gap:10px; align-items:center; padding:6px 0; border-top:1px dashed var(--line)}
  .row:first-child{border-top:none}
  label{font-weight:600; font-size:13px}
  input,select,textarea,button{font-size:15px}
  input,select,textarea{width:100%; padding:10px 12px; border:1px solid var(--line); border-radius:10px}
  select{min-width:0}
  button{appearance:none; border:1px solid var(--line); background:#fff; color:var(--ink); padding:10px 12px; border-radius:10px; cursor:pointer}
  .help{font-size:12px; color:var(--muted)}
  .chips{display:flex; flex-wrap:wrap; gap:6px}
  .chip{border:1px solid var(--line); padding:6px 10px; border-radius:999px; cursor:pointer; font-size:12px; background:#fff}
  .chip[data-active="1"]{background:#ecfeff; border-color:#67e8f9}
  .grid2{display:grid; grid-template-columns:repeat(2,1fr); gap:8px}
  .grid3{display:grid; grid-template-columns:repeat(3,1fr); gap:8px}
  .addr-grid{display:grid; grid-template-columns:1.6fr 2.1fr 2.6fr; gap:10px}
  .labeled{display:grid; gap:6px}
  .lbl{font-size:12px; color:var(--muted)}
  /* preview & reset buttons (FAB) */
  .fab{position:fixed; right:16px; bottom:16px; z-index:20; display:flex; gap:8px; flex-wrap:wrap}
  .preview-btn{padding:12px 16px; border-radius:999px; border:1px solid var(--line); background:var(--accent); color:#fff; font-weight:700; cursor:pointer; box-shadow:0 4px 14px rgba(2,132,199,.35)}
  .preview-btn.alt{background:#fff; color:#111827}
  /* modal */
  .modal{position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; padding:16px; z-index:30}
  .modal.show{display:flex}
  .modal-card{background:#fff; width:min(860px,100%); max-height:90vh; overflow:auto; border-radius:16px; border:1px solid var(--line);}
  .modal-head{display:flex; justify-content:space-between; align-items:center; padding:14px 16px; border-bottom:1px solid var(--line)}
  .modal-body{padding:14px 16px}
  .kvs{display:grid; grid-template-columns:180px 1fr; gap:10px; align-items:start}
  .kvs div{padding:6px 0; border-top:1px dashed var(--line)}
  .kvs div:nth-child(-n+2){border-top:none}
  .pill{display:inline-block; padding:2px 8px; border:1px solid var(--line); border-radius:999px; margin:2px; background:#fff; font-size:12px}
</style>
</head>
<body>
<header><div class="wrap"><h1>유품정리 사전 체크리스트 </h1></div></header>
<main class="wrap">
  <div class="grid">
    <!-- 1) 기본 정보 -->
    <section class="card">
      <h2>1) 기본 정보</h2>
      <div class="row">
        <label>주소</label>
        <div>
          <div class="addr-grid">
            <select id="addrSido"></select>
            <select id="addrSigungu"></select>
            <select id="addrEmdSel"></select>
          </div>
          <div class="help"></div>
          <div class="help" id="emdStatus">전국 EMD: 로딩 중...</div>
          <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap">
            <button id="btnEmd" type="button">전국 emd.json 불러오기</button>
            <input id="emdFile" type="file" accept="application/json" style="display:none" />
          </div>
        </div>
      </div>
      <div class="row"><label for="housing">주거환경</label><select id="housing"><option value="">선택</option><option>아파트</option><option>빌라</option><option>단독주택</option><option>오피스텔</option><option>기타</option></select></div>
      <div class="row"><label for="py">평수 (직접입력)</label><input id="py" type="number" min="1" max="100" step="1" placeholder="" /></div>
      <div class="row"><label for="rooms">방 개수</label><input id="rooms" type="number" min="1" max="10" placeholder="" /></div>
      <div class="row"><label for="baths">화장실 개수</label><input id="baths" type="number" min="1" max="5" placeholder="" /></div>
      <div class="row"><label for="vers">베란다 개수</label><input id="vers" type="number" min="1" max="5" placeholder="" /></div>
    </section>

    <!-- 2) 접근성 -->
    <section class="card">
      <h2>2) 접근성 · 엘리베이터 · 주차</h2>
      <div class="row"><label>현관문 크기</label><div class="grid2"><input id="doorW" type="number" min="50" max="150" placeholder="가로(cm)" /> <input id="doorH" type="number" min="50" max="150" placeholder="높이(cm)" /></div><div class="help">각 50~150cm</div></div>
      <div class="row"><label for="elev">엘리베이터</label><select id="elev"><option value="">선택</option><option>있음</option><option>없음</option></select></div>
      <div class="row"><label>엘베 크기 (직접입력)</label><div class="grid3"><input id="evDoor" type="number" placeholder="입구 폭(cm)" /> <input id="evW" type="number" placeholder="내부 가로(cm)" /> <input id="evD" type="number" placeholder="내부 깊이(cm)" /> <input id="evH" type="number" placeholder="내부 높이(cm)" /></div></div>
      <div class="row"><label for="evStairs">엘베 앞 계단</label><select id="evStairs"><option value="">선택</option><option>있음</option><option>없음</option></select></div>
      <div class="row"><label for="ladderUse">사다리차/계단</label><select id="ladderUse"><option value="">선택</option><option>사다리차 가능</option><option>사다리차 불가</option><option>계단 이용</option></select></div>
      <div class="row"><label>엘베 사용/요금</label><div class="grid2"><select id="evUse"><option value="">선택</option><option>사용 가능</option><option>사용 불가</option></select><select id="evFee"><option value="">선택</option><option>사용료 있음</option><option>사용료 없음</option></select></div></div>
      <div class="row"><label for="parking">주차 여건</label><select id="parking"><option value="">선택</option><option>주차장 있음</option><option>도로주차 가능</option><option>도로주차 어려움</option><option>무단주차 위험</option></select></div>
      <div class="row"><label>진입로/차량</label><div class="chips" id="accessChips"></div><div class="help">여러 개 선택 가능</div></div>
    </section>

    <!-- 3) 가전 · 설비 -->
    <section class="card">
      <h2>3) 가전 · 설비</h2>
      <div class="row"><label>에어컨</label>
        <div class="grid2">
          <div class="labeled"><div class="lbl">대수</div><input id="airconCnt" type="number" min="0" value="" placeholder="대수" /></div>
          <div class="labeled"><div class="lbl">철거여부 체크</div><select id="airconRemove"><option value="">선택</option><option>철거안됨</option><option>철거됨</option></select></div>
        </div>
      </div>
      <div class="row"><label>냉장고</label>
        <div class="grid3">
          <div class="labeled"><div class="lbl">4문 냉장고</div><input id="ref4" type="number" min="0" value="" /></div>
          <div class="labeled"><div class="lbl">2문 냉장고</div><input id="ref2" type="number" min="0" value="" /></div>
          <div class="labeled"><div class="lbl">김치 냉장고</div><input id="refK" type="number" min="0" value="" /></div>
        </div>
        <div class="help" style="margin-top:6px">
          <select id="refContent"><option value="">선택</option><option>내용물 정리 필요</option><option>정리되어 있음</option></select>
        </div>
      </div>
      <div class="row"><label for="washer">세탁기</label><input id="washer" type="number" min="0" max="3" value="" /></div>
      <div class="row"><label for="dryer">건조기</label><input id="dryer" type="number" min="0" max="3" value="" /></div>
      <div class="row"><label for="styler">스타일러</label><input id="styler" type="number" min="0" max="3" value="" /></div>
    </section>

    <!-- 4) 대형 가구 -->
    <section class="card">
      <h2>4) 대형 가구</h2>
      <div class="row"><label for="stoneBed">돌침대</label><input id="stoneBed" type="number" min="0" max="3" value="" /></div>
      <div class="row"><label for="piano">피아노</label><input id="piano" type="number" min="0" max="3" value="" /></div>
      <div class="row"><label for="closet">장롱</label><input id="closet" type="number" min="0" max="10" value="" /></div>
      <div class="row"><label for="drawer">서랍장</label><input id="drawer" type="number" min="0" max="10" value="" /></div>
      <div class="row"><label for="bed">침대(세트)</label><input id="bed" type="number" min="0" max="6" value="" /></div>
      <div class="row"><label>쇼파(사이즈별)</label>
        <div class="grid3">
          <div class="labeled"><div class="lbl">1인용</div><input id="sofa1" type="number" min="0" value="" /></div>
          <div class="labeled"><div class="lbl">2인용</div><input id="sofa2" type="number" min="0" value="" /></div>
          <div class="labeled"><div class="lbl">3인용</div><input id="sofa3" type="number" min="0" value="" /></div>
          <div class="labeled"><div class="lbl">4인용</div><input id="sofa4" type="number" min="0" value="" /></div>
          <div class="labeled"><div class="lbl">5인용</div><input id="sofa5" type="number" min="0" value="" /></div>
          <div class="labeled"><div class="lbl">6인용</div><input id="sofa6" type="number" min="0" value="" /></div>
        </div>
      </div>
      <div class="row"><label>식탁</label>
        <div class="grid2">
          <div class="labeled"><div class="lbl">대리석 식탁</div><input id="tableMarble" type="number" min="0" value="" /></div>
          <div class="labeled"><div class="lbl">일반 식탁</div><input id="tableNormal" type="number" min="0" value="" /></div>
        </div>
      </div>
      <div class="row"><label for="desk">책상</label><input id="desk" type="number" min="0" max="6" value="" /></div>
      <div class="row"><label for="bookcase">책장</label><input id="bookcase" type="number" min="0" max="10" value="" /></div>
      <div class="row"><label for="display">장식장</label><input id="display" type="number" min="0" max="10" value="" /></div>
      <div class="row"><label for="massage">안마의자</label><input id="massage" type="number" min="0" max="5" value="" /></div>
      <div class="row"><label for="mattress">매트리스</label><input id="mattress" type="number" min="0" max="5" value="" /></div>
    </section>

    <!-- 5) 소형 · 다량 품목 -->
    <section class="card">
      <h2>5) 소형 · 다량 품목</h2>
      <div class="row"><label for="plant">화분</label><input id="plant" type="number" min="0" max="50" value="" /></div>
      <div class="row"><label for="jar">항아리</label><input id="jar" type="number" min="0" max="30" value="" /></div>
      <div class="row"><label for="wheelChair">바퀴 의자</label><input id="wheelChair" type="number" min="0" max="20" value="" /></div>
      <div class="row"><label for="diningChair">식탁 의자</label><input id="diningChair" type="number" min="0" max="10" value="" /></div>
      <div class="row"><label for="tvStand">TV 단스</label><input id="tvStand" type="number" min="0" max="4" value="" /></div>
      <div class="row"><label for="dresser">화장대</label><input id="dresser" type="number" min="0" max="5" value="" /></div>
    </section>

    <!-- 6) 메모 -->
    <section class="card">
      <h2>6) 메모</h2>
      <div class="row"><label for="memo">추가 메모</label><textarea id="memo" rows="5" placeholder="특이사항 (정원/허용중량, 코너소파, 관리사무소 규정, 진입로 높이 제한 등)"></textarea></div>
    </section>
  </div>
</main>

<!-- Inline 전국 읍/면/동 일부(수도권 중심) JSON: 필요 시 외부 emd.json로 자동 병합됨 -->
<script id="emd_inline" type="application/json">{
  "서울특별시|강동구": ["천호동","성내동","길동","둔촌동","암사동","명일동","고덕동","상일동"],
  "서울특별시|송파구": ["가락동","거여동","마천동","문정동","방이동","삼전동","석촌동","송파동","신천동","오금동","잠실동","장지동","풍납동"],
  "서울특별시|강남구": ["개포동","논현동","대치동","도곡동","삼성동","세곡동","수서동","신사동","압구정동","역삼동","일원동","청담동"],
  "서울특별시|서초구": ["서초동","반포동","방배동","잠원동","양재동","내곡동"],
  "서울특별시|광진구": ["광장동","구의동","자양동","화양동","중곡동"],
  "서울특별시|종로구": ["청운동","신교동","궁정동","효자동","통인동","사직동","삼청동","부암동","평창동","이화동"],
  "서울특별시|마포구": ["공덕동","대흥동","도화동","망원동","상암동","서교동","성산동","연남동","염리동","합정동"],
  "인천광역시|연수구": ["송도동","연수동","옥련동","선학동","청학동"],
  "인천광역시|남동구": ["구월동","간석동","만수동","서창동","논현동"],
  "인천광역시|부평구": ["부평동","부개동","삼산동","갈산동","일신동","청천동"],
  "경기도|하남시": ["덕풍동","망월동","미사동","위례동"],
  "경기도|남양주시": ["다산동","별내동","평내동","호평동","화도읍","진접읍","오남읍"],
  "경기도|성남시 분당구": ["정자동","서현동","수내동","이매동","야탑동","금곡동","구미동","판교동","삼평동"]
}</script>

<!-- FAB: 미리보기 + 초기화 -->
<div class="fab">
  <button class="preview-btn" id="btnPreview">미리보기</button>
  <button class="preview-btn alt" id="btnReset">초기화</button>
</div>

<div class="modal" id="previewModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-card">
    <div class="modal-head"><strong id="modalTitle">작성 내용 미리보기</strong><button id="btnClose" style="border:1px solid var(--line); background:#fff; padding:6px 10px; border-radius:10px; cursor:pointer">닫기</button></div>
    <div class="modal-body" id="previewBody"></div>
  </div>
</div>

<script>
// ========= DOM refs (주소 포함) =========
const sidoSel = document.getElementById('addrSido');
const sigunguSel = document.getElementById('addrSigungu');
const emdSel = document.getElementById('addrEmdSel');

// ====== 행정구역 데이터(요약/샘플) ======
const SIDO=[
  '전국','서울특별시','부산광역시','대구광역시','인천광역시','광주광역시','대전광역시','울산광역시','세종특별자치시',
  '경기도','강원특별자치도','충청북도','충청남도','전라북도','전라남도','경상북도','경상남도','제주특별자치도'
];
const SIGUNGU={
  '서울특별시':['강남구','강동구','강북구','강서구','관악구','광진구','구로구','금천구','노원구','도봉구','동대문구','동작구','마포구','서대문구','서초구','성동구','성북구','송파구','양천구','영등포구','용산구','은평구','종로구','중구','중랑구'],
  '인천광역시':['중구','동구','미추홀구','연수구','남동구','부평구','계양구','서구','강화군','옹진군'],
  '경기도':['수원시 장안구','수원시 권선구','수원시 팔달구','수원시 영통구','성남시 수정구','성남시 중원구','성남시 분당구','의정부시','안양시 만안구','안양시 동안구','부천시','광명시','평택시','동두천시','안산시 상록구','안산시 단원구','고양시 덕양구','고양시 일산동구','고양시 일산서구','과천시','구리시','남양주시','오산시','시흥시','군포시','의왕시','하남시','용인시 처인구','용인시 기흥구','용인시 수지구','파주시','이천시','안성시','김포시','화성시','광주시(경기)','양주시','포천시','여주시','연천군','가평군','양평군'],
  '부산광역시':['중구','서구','동구','영도구','부산진구','동래구','남구','북구','해운대구','사하구','금정구','강서구','연제구','수영구','사상구','기장군'],
  '대구광역시':['중구','동구','서구','남구','북구','수성구','달서구','달성군','군위군'],
  '광주광역시':['동구','서구','남구','북구','광산구'],
  '대전광역시':['동구','중구','서구','유성구','대덕구'],
  '울산광역시':['중구','남구','동구','북구','울주군'],
  '세종특별자치시':['세종시'],
  '강원특별자치도':['춘천시','원주시','강릉시','동해시','태백시','속초시','삼척시','홍천군','횡성군','영월군','평창군','정선군','철원군','화천군','양구군','인제군','고성군','양양군'],
  '충청북도':['청주시 상당구','청주시 서원구','청주시 흥덕구','청주시 청원구','충주시','제천시','보은군','옥천군','영동군','증평군','진천군','괴산군','음성군','단양군'],
  '충청남도':['천안시 동남구','천안시 서북구','공주시','보령시','아산시','서산시','논산시','계룡시','당진시','금산군','부여군','서천군','청양군','홍성군','예산군','태안군'],
  '전라북도':['전주시 완산구','전주시 덕진구','군산시','익산시','정읍시','남원시','김제시','완주군','진안군','무주군','장수군','임실군','순창군','고창군','부안군'],
  '전라남도':['목포시','여수시','순천시','나주시','광양시','담양군','곡성군','구례군','고흥군','보성군','화순군','장흥군','강진군','해남군','영암군','무안군','함평군','영광군','장성군','완도군','진도군','신안군'],
  '경상북도':['포항시 남구','포항시 북구','경주시','김천시','안동시','구미시','영주시','영천시','상주시','문경시','경산시','의성군','청송군','영양군','영덕군','청도군','고령군','성주군','칠곡군','예천군','봉화군','울진군','울릉군'],
  '경상남도':['창원시 의창구','창원시 성산구','창원시 마산합포구','창원시 마산회원구','창원시 진해구','진주시','통영시','사천시','김해시','밀양시','거제시','양산시','의령군','함안군','창녕군','고성군','남해군','하동군','산청군','함양군','거창군','합천군'],
  '제주특별자치도':['제주시','서귀포시']
};

// 읍면동: 기본 샘플 + 외부 JSON(emd.json) 병합
const EMD={
  '서울특별시|강동구':['천호동','길동','둔촌동','성내동','암사동','명일동','고덕동','상일동'],
  '서울특별시|강남구':['개포동','논현동','대치동','도곡동','삼성동','세곡동','수서동','신사동','압구정동','역삼동','일원동','청담동'],
  '서울특별시|송파구':['가락동','거여동','마천동','문정동','방이동','삼전동','석촌동','송파동','신천동','오금동','잠실동','장지동','풍납동'],
  '인천광역시|연수구':['송도동','연수동','옥련동','선학동','청학동'],
  '경기도|남양주시':['다산동','별내동','평내동','호평동','화도읍','진접읍','오남읍'],
  '경기도|하남시':['덕풍동','망월동','미사동','위례동']
};
let EMD_EXTRA = null; // 전국 EMD 저장소

// ====== 주소 보조 함수 ======
function setOptions(sel, arr, placeholder){
  if(!sel) return; sel.innerHTML='';
  const o0=document.createElement('option'); o0.value=''; o0.textContent=placeholder||'선택'; sel.appendChild(o0);
  (arr||[]).forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; sel.appendChild(o); });
}
function initAddress(){
  setOptions(sidoSel, SIDO, '시/도');
  setOptions(sigunguSel, [], '구/시/군');
  setOptions(emdSel, [], '읍/면/동');
}

// ====== 진입로 칩 생성 ======
(function buildAccessChips(){
  const accessOpts=['1톤 진입 가능','1톤 진입 불가','2.5톤 진입 가능','2.5톤 진입 불가','5톤 진입 가능','5톤 진입 불가','사다리차 진입 가능','사다리차 진입 불가능','기타'];
  const wrap=document.getElementById('accessChips');
  if(!wrap) return;
  accessOpts.forEach(t=>{const s=document.createElement('span'); s.className='chip'; s.textContent=t; s.dataset.active='0'; s.onclick=()=>{s.dataset.active=s.dataset.active==='1'?'0':'1'}; wrap.appendChild(s);});
})();

// ====== EMD 상태/불러오기 ======
const emdStatusEl = document.getElementById('emdStatus');
const btnEmd = document.getElementById('btnEmd');
const emdFile = document.getElementById('emdFile');

function setEmdStatus(txt, ok){
  if(!emdStatusEl) return;
  emdStatusEl.textContent = `전국 EMD: ${txt}`;
  emdStatusEl.style.color = ok ? '#047857' : '#b45309';
}
function mergeEMD(obj){
  EMD_EXTRA = obj || {};
  const keys = Object.keys(EMD_EXTRA||{});
  let total = 0; keys.forEach(k => { const arr = EMD_EXTRA[k]; if(Array.isArray(arr)) total += arr.length; });
  setEmdStatus(`로드됨 (지역 ${keys.length}개, 항목 ${total}개)`, true);
  if (sidoSel && sidoSel.value!=null) { sidoSel.dispatchEvent(new Event('change')); }
  if (sigunguSel && sigunguSel.value!=null) { sigunguSel.dispatchEvent(new Event('change')); }
}
btnEmd?.addEventListener('click', ()=> emdFile?.click());
emdFile?.addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=> { try { const data = JSON.parse(reader.result); mergeEMD(data); } catch(err){ setEmdStatus('파일 파싱 실패', false); } };
  reader.readAsText(f, 'utf-8');
});
(async function loadNationwideEMD(){
  try{ setEmdStatus('불러오는 중...', false); const res = await fetch('emd.json', {method:'GET'});
    if(res.ok){ const data = await res.json(); mergeEMD(data); }
    else { setEmdStatus('파일이 없어 수동 불러오기가 필요합니다.', false); }
  }catch(e){ setEmdStatus('파일이 없어 수동 불러오기가 필요합니다.', false); }
})();

// ====== 주소 선택 동작 ======
initAddress();
if(sidoSel){
  sidoSel.addEventListener('change',()=>{
    const v=sidoSel.value; const list=(v && v!=='전국') ? (SIGUNGU[v]||[]) : [];
    setOptions(sigunguSel, list, '구/시/군'); setOptions(emdSel, [], '읍/면/동');
  });
}
if(sigunguSel){
  sigunguSel.addEventListener('change',()=>{
    const s=sidoSel?.value; const g=sigunguSel.value; const key = s && g ? `${s}|${g}` : null;
    const list = key ? ( (EMD[key]||[]).concat((EMD_EXTRA&&EMD_EXTRA[key])||[]) ) : [];
    setOptions(emdSel, list, '읍/면/동');
  });
}

// ====== 미리보기 & 초기화 ======
const btnPreview=document.getElementById('btnPreview');
const btnReset=document.getElementById('btnReset');
const modal=document.getElementById('previewModal');
const btnClose=document.getElementById('btnClose');
const bodyEl=document.getElementById('previewBody');

btnPreview.addEventListener('click', ()=>{ const f = collect(); bodyEl.innerHTML = renderPreview(f); modal.classList.add('show'); });
btnClose.addEventListener('click', ()=> modal.classList.remove('show'));
modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.classList.remove('show'); });
btnReset.addEventListener('click', resetForm);

function setVal(id,val){const el=document.getElementById(id); if(el!=null){ el.value=val; }}
function setSel(id,idx){const el=document.getElementById(id); if(el!=null){ el.selectedIndex=idx; }}
function resetForm(){
  initAddress();
  ['housing','elev','evStairs','ladderUse','evUse','evFee','parking','refContent','airconRemove'].forEach(id=>setSel(id,0));
  ['py','rooms','baths','vers','doorW','doorH','evDoor','evW','evD','evH','airconCnt','ref4','ref2','refK','washer','dryer','styler','stoneBed','piano','closet','drawer','bed','sofa1','sofa2','sofa3','sofa4','sofa5','sofa6','tableMarble','tableNormal','desk','bookcase','display','massage','mattress','plant','jar','wheelChair','diningChair','tvStand','dresser'].forEach(id=>setVal(id,''));
  document.querySelectorAll('#accessChips .chip').forEach(c=>c.dataset.active='0');
  setVal('memo','');
  if (typeof modal !== 'undefined' && modal) { modal.classList.remove('show'); }
  try{ window.scrollTo({top:0, behavior:'smooth'}); }catch(e){ window.scrollTo(0,0); }
}

function collect(){
  const chipSel = Array.from(document.querySelectorAll('#accessChips .chip')).filter(c=>c.dataset.active==='1').map(c=>c.textContent);
  function val(id){const el=document.getElementById(id); return el?el.value:''}
  function num(id){const el=document.getElementById(id); return el && el.value!==''?parseInt(el.value,10):0}
  const sofa={s1:num('sofa1'),s2:num('sofa2'),s3:num('sofa3'),s4:num('sofa4'),s5:num('sofa5'),s6:num('sofa6')};
  return {
    region: composeRegion(), housing: val('housing'), py:num('py'), rooms:num('rooms'), baths:num('baths'), vers:num('vers'),
    doorW:num('doorW'), doorH:num('doorH'), elev: val('elev'), evDoor:num('evDoor'), evW:num('evW'), evD:num('evD'), evH:num('evH'), evStairs: val('evStairs'),
    ladderUse: val('ladderUse'), evUse: val('evUse'), evFee: val('evFee'), parking: val('parking'), access: chipSel,
    airconCnt:num('airconCnt'), airconRemove:val('airconRemove'),
    ref4:num('ref4'), ref2:num('ref2'), refK:num('refK'), refContent:val('refContent'),
    washer:num('washer'), dryer:num('dryer'), styler:num('styler'),
    stoneBed:num('stoneBed'), piano:num('piano'), closet:num('closet'), drawer:num('drawer'), bed:num('bed'), sofa,
    tableMarble:num('tableMarble'), tableNormal:num('tableNormal'), desk:num('desk'), bookcase:num('bookcase'), display:num('display'), massage:num('massage'), mattress:num('mattress'),
    plant:num('plant'), jar:num('jar'), wheelChair:num('wheelChair'), diningChair:num('diningChair'), tvStand:num('tvStand'), dresser:num('dresser'),
    memo: val('memo')
  };
}

function composeRegion(){
  if(!(sidoSel && sigunguSel && emdSel)) return '';
  const s=sidoSel.value; const g=sigunguSel.value; const e=emdSel.value;
  if(!s) return '';
  if(s==='전국') return '전국';
  return [s,g,e].filter(Boolean).join(' ');
}

function renderPreview(f){
  const sofaTotal=f.sofa.s1+f.sofa.s2+f.sofa.s3+f.sofa.s4+f.sofa.s5+f.sofa.s6;
  const g = (k,v)=>`<div><strong>${k}</strong></div><div>${v}</div>`;
  const lines=[
    g('지역/주거', esc(`${f.region||'-'} / ${f.housing||'-'}`)),
    g('평형/구성', esc(`${f.py||0}평 · 방 ${f.rooms||0} · 욕실 ${f.baths||0} · 베란다 ${f.vers||0}`)),
    g('출입/엘베', esc(`현관문 ${f.doorW||'-'}×${f.doorH||'-'}cm · 엘베 ${f.elev||'-'} · 앞계단 ${f.evStairs||'-'}`)),
    f.elev==='있음' ? g('엘베 규격', esc(`입구 ${f.evDoor||'-'}cm · 내부 ${f.evW||'-'}×${f.evD||'-'}×${f.evH||'-'}cm`)) : '',
    g('사다리·주차·진입', `${esc(`${f.ladderUse||'-'} · ${f.parking||'-'}`)}<br>${f.access.length?f.access.map(a=>`<span class="pill">${esc(a)}</span>`).join(' '):'-'}`),
    g('냉장고', esc(`4문 ${f.ref4} / 2문 ${f.ref2} / 김치 ${f.refK} · (${f.refContent||'-'})`)),
    g('가전', esc(`에어컨 ${f.airconCnt}${f.airconRemove?`(${f.airconRemove})`:''} · 세탁기 ${f.washer} · 건조기 ${f.dryer} · 스타일러 ${f.styler}`)),
    g('가구(주요)', esc(`돌침대 ${f.stoneBed} · 피아노 ${f.piano} · 장롱 ${f.closet} · 서랍장 ${f.drawer} · 침대세트 ${f.bed} · 쇼파합계 ${sofaTotal}`)),
    g('식탁', esc(`대리석 ${f.tableMarble} · 일반 ${f.tableNormal}`)),
    g('기타/소형', esc(`책상 ${f.desk} · 책장 ${f.bookcase} · 장식장 ${f.display} · 안마의자 ${f.massage} · 매트리스 ${f.mattress}`)),
    g('소형 다량', esc(`화분 ${f.plant} · 항아리 ${f.jar} · 바퀴 의자 ${f.wheelChair} · 식탁의자 ${f.diningChair} · TV단스 ${f.tvStand} · 화장대 ${f.dresser}`)),
    f.memo?g('메모', esc(f.memo)):''
  ].filter(Boolean);
  return `<div class="kvs">${lines.join('')}</div>`;
}

function esc(s){return String(s).replace(/[&<>"']/g,(c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])))}

// ====== 화면에서 주소 섹션 숨김(요청 사항: 옵션에서 주소 제거) ======
(function hideAddressRow(){
  try { var r=document.getElementById('addrSido'); if(r){ var row=r.closest('.row'); if(row){ row.remove ? row.remove() : row.style.display='none'; } } } catch(e){}
})();

// ====== 내장 자가 테스트 ======
(function selfTests(){
  try{
    console.groupCollapsed('[Checklist v1] Self-tests');
    console.assert(typeof sidoSel !== 'undefined', 'sidoSel should be defined');
    console.assert(typeof composeRegion === 'function', 'composeRegion fn exists');
    // T1: composeRegion should not throw even if address hidden
    try { const r = composeRegion(); console.info('T1 composeRegion ok ->', r); } catch(e){ console.error('T1 failed', e); }
    // T2: mergeEMD should not throw with minimal payload
    try { mergeEMD({ '서울특별시|강동구': ['천호동'] }); console.info('T2 mergeEMD ok'); } catch(e){ console.error('T2 failed', e); }
    // T3: resetForm should clear key fields without throwing
    try { document.getElementById('py').value='33'; resetForm(); console.info('T3 resetForm ok'); } catch(e){ console.error('T3 failed', e); }
    console.groupEnd();
  }catch(e){ /* ignore */ }
})();
</script>
</body>
</html>
